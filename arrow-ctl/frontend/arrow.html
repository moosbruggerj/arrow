<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>Arro(w)</title>
  <link rel="stylesheet" href="static/css/bulma.min.css">
  <link rel="stylesheet" href="static/css/fa.min.css">
  <script src="static/main.js"></script>
</head>
<body>
  <script>
	let app = Elm.Main.init();
	fetch("/api/client/new")
      .then(response => {
        if(!response.ok) {
          throw new Error("Network Error: Status = " + response.status);
        }
        return response.json();
      })
      .then(data => {
        let url = "ws://" + window.location.host + data.url;
        let socket = new WebSocket(url);
        //app.ports.sendMessage.subscribe(msg => socket.send(JSON.stringify(msg)));

        socket.addEventListener("message", event => {
          app.ports.onMessageReceived.send(JSON.parse(event.data));
        });
      })
      .catch(err => { console.log(err);
        app.ports.onMessageReceived.send({ update: { error: "Websocket error: " + err }});
      });
  </script>
</body>
</html>
